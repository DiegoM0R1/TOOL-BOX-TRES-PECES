<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ToolBox Pro - Herramientas Online Gratuitas</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode/1.5.3/qrcode.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 0;
            text-align: center;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header h1 {
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .header p {
            color: #666;
            font-size: 1.1rem;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .tool-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .tool-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }

        .tool-card h3 {
            color: #333;
            font-size: 1.5rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .tool-icon {
            font-size: 2rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #555;
        }

        .form-control {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.8);
        }

        .form-control:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 1rem;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: linear-gradient(45deg, #00b894, #55a3ff);
            margin-top: 0.5rem;
        }

        .file-input-wrapper {
            position: relative;
            display: inline-block;
            width: 100%;
        }

        .file-input {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .file-input-display {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 1rem;
            border: 2px dashed #ccc;
            border-radius: 10px;
            transition: all 0.3s ease;
            text-align: center;
            color: #666;
        }

        .file-input-display:hover {
            border-color: #667eea;
            color: #667eea;
        }

        .result-container {
            margin-top: 1.5rem;
            text-align: center;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .qr-result {
            max-width: 300px;
            margin: 0 auto;
        }

        .qr-result canvas {
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .loading {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 3px solid rgba(102, 126, 234, 0.3);
            border-radius: 50%;
            border-top-color: #667eea;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error-message {
            background: #ffe6e6;
            color: #d63031;
            padding: 1rem;
            border-radius: 10px;
            margin-top: 1rem;
            border: 1px solid #fab1a0;
        }

        .success-message {
            background: #e6ffe6;
            color: #00b894;
            padding: 1rem;
            border-radius: 10px;
            margin-top: 1rem;
            border: 1px solid #a8e6cf;
        }

        .preview-image {
            max-width: 100%;
            max-height: 300px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            margin: 1rem 0;
        }

        .canvas-container {
            position: relative;
            display: inline-block;
            margin: 1rem 0;
        }

        .canvas-container canvas {
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            cursor: crosshair;
        }

        .color-picker-container {
            display: flex;
            gap: 1rem;
            align-items: center;
            margin: 1rem 0;
            justify-content: center;
            flex-wrap: wrap;
        }

        .color-picker {
            width: 50px;
            height: 50px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .tolerance-slider {
            width: 150px;
        }

        .video-info {
            background: rgba(102, 126, 234, 0.1);
            padding: 1rem;
            border-radius: 10px;
            margin: 1rem 0;
            text-align: left;
        }

        .download-links {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .download-link {
            background: linear-gradient(45deg, #00b894, #55a3ff);
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .download-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 184, 148, 0.4);
        }

        @media (max-width: 768px) {
            .tools-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .container {
                padding: 1rem;
            }

            .color-picker-container {
                flex-direction: column;
            }
        }

        .url-result-box {
            background: rgba(255,255,255,0.8);
            padding: 1rem;
            border-radius: 10px;
            margin: 1rem 0;
            word-break: break-all;
            font-family: monospace;
            border: 2px solid #667eea;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üõ†Ô∏è ToolBox Pro</h1>
        <p>Tu suite completa de herramientas online gratuitas - 100% JavaScript</p>
    </div>

    <div class="container">
        <div class="tools-grid">
            <!-- Generador de QR -->
            <div class="tool-card">
                <h3><span class="tool-icon">üì±</span>Generador QR con Logo</h3>
                <div class="form-group">
                    <label for="qr-text">Texto o URL:</label>
                    <input type="text" id="qr-text" class="form-control" placeholder="Ingresa el texto o URL" value="https://diegomori.online">
                </div>
                <div class="form-group">
                    <label for="qr-logo">Logo/Imagen (opcional):</label>
                    <div class="file-input-wrapper">
                        <input type="file" id="qr-logo" class="file-input" accept="image/*">
                        <div class="file-input-display">
                            üìÅ Seleccionar imagen
                        </div>
                    </div>
                </div>
                <button onclick="generateQR()" class="btn">Generar QR</button>
                <div id="qr-result" class="result-container"></div>
            </div>

            <!-- Removedor de Fondos -->
            <div class="tool-card">
                <h3><span class="tool-icon">üé®</span>Remover Fondo por Color</h3>
                <div class="form-group">
                    <label for="bg-image">Seleccionar imagen:</label>
                    <div class="file-input-wrapper">
                        <input type="file" id="bg-image" class="file-input" accept="image/*">
                        <div class="file-input-display">
                            üìÅ Seleccionar imagen
                        </div>
                    </div>
                </div>
                <button onclick="loadImageForBgRemoval()" class="btn">Cargar Imagen</button>
                <div id="bg-result" class="result-container"></div>
            </div>

            <!-- Convertidor de Videos (Descargador) -->
            <div class="tool-card">
                <h3><span class="tool-icon">üé¨</span>Descargador de Videos</h3>
                <div class="form-group">
                    <label for="video-url">URL del video:</label>
                    <input type="url" id="video-url" class="form-control" placeholder="https://youtube.com/watch?v=..." value="https://youtube.com/watch?v=dQw4w9WgXcQ">
                </div>
                <div class="form-group">
                    <label for="video-format">Formato preferido:</label>
                    <select id="video-format" class="form-control">
                        <option value="mp4">MP4 (Video)</option>
                        <option value="mp3">MP3 (Audio)</option>
                        <option value="webm">WebM</option>
                        <option value="avi">AVI</option>
                    </select>
                </div>
                <button onclick="processVideoUrl()" class="btn">Procesar Video</button>
                <div id="video-result" class="result-container"></div>
            </div>

            <!-- Acortador de URLs -->
            <div class="tool-card">
                <h3><span class="tool-icon">üîó</span>Acortador de URLs</h3>
                <div class="form-group">
                    <label for="long-url">URL larga:</label>
                    <input type="url" id="long-url" class="form-control" placeholder="https://ejemplo.com/url-muy-larga">
                </div>
                <button onclick="shortenUrl()" class="btn">Acortar URL</button>
                <div id="url-result" class="result-container"></div>
            </div>

            <!-- Convertidor de Colores -->
            <div class="tool-card">
                <h3><span class="tool-icon">üåà</span>Convertidor de Colores</h3>
                <div class="form-group">
                    <label for="color-input">Selecciona un color:</label>
                    <input type="color" id="color-input" class="form-control" value="#667eea" style="height: 60px;">
                </div>
                <button onclick="convertColors()" class="btn">Convertir Formatos</button>
                <div id="color-result" class="result-container"></div>
            </div>

            <!-- Generador de Contrase√±as -->
            <div class="tool-card">
                <h3><span class="tool-icon">üîê</span>Generador de Contrase√±as</h3>
                <div class="form-group">
                    <label for="password-length">Longitud:</label>
                    <input type="range" id="password-length" class="form-control" min="4" max="50" value="16">
                    <span id="length-display">16</span>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="include-uppercase" checked> May√∫sculas (A-Z)
                    </label>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="include-lowercase" checked> Min√∫sculas (a-z)
                    </label>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="include-numbers" checked> N√∫meros (0-9)
                    </label>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="include-symbols" checked> S√≠mbolos (!@#$%)
                    </label>
                </div>
                <button onclick="generatePassword()" class="btn">Generar Contrase√±a</button>
                <div id="password-result" class="result-container"></div>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let qrCanvas = null;
        let bgCanvas = null;
        let bgCtx = null;
        let originalImageData = null;
        let shortenedUrls = {};

        // Inicializar localStorage
        try {
            shortenedUrls = JSON.parse(localStorage.getItem('shortenedUrls') || '{}');
        } catch (e) {
            shortenedUrls = {};
        }

   // REEMPLAZA TODA LA SECCI√ìN "========= GENERADOR QR =========" CON ESTE C√ìDIGO:

// ========= GENERADOR QR =========

// Funci√≥n para cargar la librer√≠a QRCode din√°micamente
function loadQRCodeLibrary() {
    return new Promise((resolve, reject) => {
        if (typeof QRCode !== 'undefined') {
            resolve();
            return;
        }

        const script = document.createElement('script');
        script.src = 'https://cdnjs.cloudflare.com/ajax/libs/qrcode/1.5.3/qrcode.min.js';
        script.onload = () => {
            if (typeof QRCode !== 'undefined') {
                resolve();
            } else {
                reject(new Error('No se pudo cargar la librer√≠a QRCode'));
            }
        };
        script.onerror = () => {
            reject(new Error('Error al cargar la librer√≠a QRCode desde CDN'));
        };
        
        document.head.appendChild(script);
    });
}

// Generador QR con implementaci√≥n alternativa
async function generateQR() {
    const text = document.getElementById('qr-text').value;
    const logoFile = document.getElementById('qr-logo').files[0];
    const resultDiv = document.getElementById('qr-result');

    if (!text.trim()) {
        showError(resultDiv, 'Por favor ingresa un texto o URL.');
        return;
    }

    showLoading(resultDiv);

    try {
        // Intentar cargar la librer√≠a QRCode
        await loadQRCodeLibrary();
        
        const canvas = document.createElement('canvas');
        
        await QRCode.toCanvas(canvas, text, {
            width: 300,
            margin: 2,
            errorCorrectionLevel: 'H',
            color: {
                dark: '#000000',
                light: '#FFFFFF'
            }
        });

        if (logoFile) {
            await addLogoToQR(canvas, logoFile);
        }
        
        showQRResult(resultDiv, canvas);

    } catch (error) {
        console.error("Error al generar QR:", error);
        // Fallback: usar API externa
        generateQRFallback(text, resultDiv);
    }
}

// M√©todo alternativo usando API externa
function generateQRFallback(text, resultDiv) {
    try {
        const encodedText = encodeURIComponent(text);
        const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodedText}`;
        
        const img = document.createElement('img');
        img.src = qrUrl;
        img.style.borderRadius = '10px';
        img.style.boxShadow = '0 5px 15px rgba(0, 0, 0, 0.2)';
        img.onload = function() {
            resultDiv.innerHTML = `
                <div class="qr-result">
                    ${img.outerHTML}
                    <button onclick="downloadQRFromUrl('${qrUrl}')" class="btn btn-secondary">Descargar QR</button>
                    <p style="font-size: 0.9rem; color: #666; margin-top: 1rem;">
                        üåê Generado usando API externa
                    </p>
                </div>
            `;
        };
        img.onerror = function() {
            showError(resultDiv, 'Error: No se pudo generar el c√≥digo QR. Verifica tu conexi√≥n a internet.');
        };
    } catch (error) {
        showError(resultDiv, 'Error: No se pudo generar el c√≥digo QR.');
    }
}

function addLogoToQR(canvas, logoFile) {
    return new Promise((resolve, reject) => {
        const ctx = canvas.getContext('2d');
        const img = new Image();
        
        img.onload = function() {
            try {
                const logoSizeRatio = 0.2;
                const logoSize = canvas.width * logoSizeRatio;
                const x = (canvas.width - logoSize) / 2;
                const y = (canvas.height - logoSize) / 2;
                
                ctx.fillStyle = 'white';
                ctx.fillRect(x - 5, y - 5, logoSize + 10, logoSize + 10);
                ctx.drawImage(img, x, y, logoSize, logoSize);
                resolve();
            } catch (e) {
                reject(new Error("Error al procesar el logo: " + e.message));
            }
        };

        img.onerror = function() {
            reject(new Error("El archivo del logo no es v√°lido."));
        };

        const reader = new FileReader();
        reader.onload = (e) => img.src = e.target.result;
        reader.onerror = () => reject(new Error("Error al leer el archivo del logo."));
        reader.readAsDataURL(logoFile);
    });
}

function showQRResult(container, canvas) {
    qrCanvas = canvas;
    container.innerHTML = `
        <div class="qr-result">
            ${canvas.outerHTML}
            <button onclick="downloadQR()" class="btn btn-secondary">Descargar QR</button>
        </div>
    `;
    qrCanvas = container.querySelector('canvas');
    if (qrCanvas) {
        qrCanvas.getContext('2d', { willReadFrequently: true });
    }
}

function downloadQR() {
    if (qrCanvas) {
        const link = document.createElement('a');
        link.download = 'codigo-qr.png';
        link.href = qrCanvas.toDataURL('image/png');
        link.click();
    }
}

function downloadQRFromUrl(qrUrl) {
    const link = document.createElement('a');
    link.download = 'codigo-qr.png';
    link.href = qrUrl;
    link.target = '_blank';
    link.click();
}

       // REEMPLAZA TODA LA SECCI√ìN "============ REMOVEDOR DE FONDO ============" CON ESTE C√ìDIGO:

// ============ REMOVEDOR DE FONDO MEJORADO ============

function loadImageForBgRemoval() {
    const fileInput = document.getElementById('bg-image');
    const resultDiv = document.getElementById('bg-result');
    const file = fileInput.files[0];

    if (!file) {
        showError(resultDiv, 'Por favor selecciona una imagen');
        return;
    }

    const reader = new FileReader();
    reader.onload = function(e) {
        const img = new Image();
        img.onload = function() {
            setupBgRemovalCanvas(img, resultDiv);
        };
        img.src = e.target.result;
    };
    reader.readAsDataURL(file);
}

function setupBgRemovalCanvas(img, container) {
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d', { willReadFrequently: true });

    
    
    const maxSize = 500;
    let { width, height } = img;
    
    if (width > maxSize || height > maxSize) {
        const ratio = Math.min(maxSize / width, maxSize / height);
        width *= ratio;
        height *= ratio;
    }
    
    canvas.width = width;
    canvas.height = height;
    ctx.drawImage(img, 0, 0, width, height);
    
    bgCanvas = canvas;
    bgCtx = ctx;
    originalImageData = ctx.getImageData(0, 0, width, height);
    
    container.innerHTML = `
        <div class="canvas-container">
            ${canvas.outerHTML}
        </div>
        <div class="color-picker-container">
            <div style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap; justify-content: center;">
                <div>
                    <label>üé® Color:</label>
                    <input type="color" id="bg-color-picker" class="color-picker" value="#ffffff">
                </div>
                <div>
                    <label>üìè Tolerancia:</label>
                    <input type="range" id="tolerance-slider" class="tolerance-slider" min="0" max="150" value="30">
                    <span id="tolerance-value">30</span>
                </div>
                <div>
                    <label>üîß Algoritmo:</label>
                    <select id="removal-algorithm" class="form-control" style="width: auto;">
                        <option value="advanced">Avanzado (RGB+LAB)</option>
                        <option value="euclidean">Euclidiano mejorado</option>
                        <option value="hsv">HSV Color Space</option>
                        <option value="chroma">Chroma Key</option>
                    </select>
                </div>
            </div>
        </div>
        <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; margin: 1rem 0;">
            <button onclick="removeBackgroundAdvanced()" class="btn">üéØ Remover Fondo</button>
            <button onclick="autoDetectBackground()" class="btn" style="background: linear-gradient(45deg, #e74c3c, #c0392b);">ü§ñ Auto-detectar</button>
            <button onclick="magicWandTool()" class="btn" style="background: linear-gradient(45deg, #9b59b6, #8e44ad);">‚ú® Varita M√°gica</button>
            <button onclick="resetImage()" class="btn btn-secondary">‚Ü©Ô∏è Restaurar</button>
            <button onclick="downloadProcessedImage()" class="btn btn-secondary">üíæ Descargar</button>
        </div>
        <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; margin: 0.5rem 0;">
            <button onclick="applyEdgeSmoothing()" class="btn btn-secondary" style="font-size: 0.9rem;">üîß Suavizar Bordes</button>
            <button onclick="removeNoise()" class="btn btn-secondary" style="font-size: 0.9rem;">üßπ Quitar Ruido</button>
            <button onclick="expandSelection()" class="btn btn-secondary" style="font-size: 0.9rem;">‚ûï Expandir</button>
            <button onclick="contractSelection()" class="btn btn-secondary" style="font-size: 0.9rem;">‚ûñ Contraer</button>
        </div>
    `;
    
    bgCanvas = container.querySelector('canvas');
bgCtx = bgCanvas.getContext('2d', { willReadFrequently: true });
    
    document.getElementById('tolerance-slider').oninput = function() {
        document.getElementById('tolerance-value').textContent = this.value;
    };
    
    // Mejorado: click para seleccionar color con √°rea promedio
    bgCanvas.onclick = function(e) {
        const rect = bgCanvas.getBoundingClientRect();
        const x = Math.floor(e.clientX - rect.left);
        const y = Math.floor(e.clientY - rect.top);
        
        // Tomar muestra de √°rea 3x3 para mejor precisi√≥n
        const samples = [];
        for (let dy = -1; dy <= 1; dy++) {
            for (let dx = -1; dx <= 1; dx++) {
                const sx = Math.max(0, Math.min(bgCanvas.width - 1, x + dx));
                const sy = Math.max(0, Math.min(bgCanvas.height - 1, y + dy));
                const imageData = bgCtx.getImageData(sx, sy, 1, 1);
                samples.push(imageData.data);
            }
        }
        
        // Promedio de las muestras
        let r = 0, g = 0, b = 0;
        samples.forEach(sample => {
            r += sample[0];
            g += sample[1];
            b += sample[2];
        });
        
        r = Math.round(r / samples.length);
        g = Math.round(g / samples.length);
        b = Math.round(b / samples.length);
        
        const hex = `#${((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1)}`;
        document.getElementById('bg-color-picker').value = hex;
        
        showNotification(`üé® Color seleccionado: RGB(${r}, ${g}, ${b})`);
    };
}

// Algoritmo avanzado de remoci√≥n de fondo
function removeBackgroundAdvanced() {
    if (!originalImageData) return;
    
    const colorPicker = document.getElementById('bg-color-picker');
    const tolerance = parseInt(document.getElementById('tolerance-slider').value);
    const algorithm = document.getElementById('removal-algorithm').value;
    
    const hex = colorPicker.value;
    const targetR = parseInt(hex.slice(1, 3), 16);
    const targetG = parseInt(hex.slice(3, 5), 16);
    const targetB = parseInt(hex.slice(5, 7), 16);
    
    const imageData = bgCtx.createImageData(originalImageData);
    const data = imageData.data;
    const originalData = originalImageData.data;
    
    // Convertir color objetivo a diferentes espacios de color
    const targetLab = rgbToLab(targetR, targetG, targetB);
    const targetHsv = rgbToHsv(targetR, targetG, targetB);
    
    for (let i = 0; i < originalData.length; i += 4) {
        const r = originalData[i];
        const g = originalData[i + 1];
        const b = originalData[i + 2];
        const a = originalData[i + 3];
        
        let shouldRemove = false;
        
        switch (algorithm) {
            case 'advanced':
                shouldRemove = advancedColorMatch(r, g, b, targetR, targetG, targetB, targetLab, tolerance);
                break;
            case 'euclidean':
                shouldRemove = euclideanColorMatch(r, g, b, targetR, targetG, targetB, tolerance);
                break;
            case 'hsv':
                shouldRemove = hsvColorMatch(r, g, b, targetHsv, tolerance);
                break;
            case 'chroma':
                shouldRemove = chromaKeyMatch(r, g, b, targetR, targetG, targetB, tolerance);
                break;
        }
        
        if (shouldRemove) {
            data[i] = r;
            data[i + 1] = g;
            data[i + 2] = b;
            data[i + 3] = 0; // Transparente
        } else {
            data[i] = r;
            data[i + 1] = g;
            data[i + 2] = b;
            data[i + 3] = a;
        }
    }
    
    bgCtx.putImageData(imageData, 0, 0);
    showNotification(`‚ú® Fondo removido usando algoritmo ${algorithm}`);
}

// Algoritmos de comparaci√≥n de colores
function advancedColorMatch(r, g, b, targetR, targetG, targetB, targetLab, tolerance) {
    // Combina RGB euclidiano con LAB perceptual
    const rgbDiff = Math.sqrt(
        Math.pow(r - targetR, 2) + 
        Math.pow(g - targetG, 2) + 
        Math.pow(b - targetB, 2)
    );
    
    const currentLab = rgbToLab(r, g, b);
    const labDiff = Math.sqrt(
        Math.pow(currentLab.l - targetLab.l, 2) + 
        Math.pow(currentLab.a - targetLab.a, 2) + 
        Math.pow(currentLab.b - targetLab.b, 2)
    );
    
    const combinedDiff = (rgbDiff * 0.3 + labDiff * 0.7);
    return combinedDiff <= tolerance * 2.5;
}

function euclideanColorMatch(r, g, b, targetR, targetG, targetB, tolerance) {
    // Distancia euclidiana mejorada con pesos perceptuales
    const weightR = 0.299;
    const weightG = 0.587;
    const weightB = 0.114;
    
    const diff = Math.sqrt(
        weightR * Math.pow(r - targetR, 2) + 
        weightG * Math.pow(g - targetG, 2) + 
        weightB * Math.pow(b - targetB, 2)
    );
    
    return diff <= tolerance * 1.5;
}

function hsvColorMatch(r, g, b, targetHsv, tolerance) {
    const currentHsv = rgbToHsv(r, g, b);
    
    // Diferencia en tono (circular)
    let hueDiff = Math.abs(currentHsv.h - targetHsv.h);
    hueDiff = Math.min(hueDiff, 360 - hueDiff);
    
    const satDiff = Math.abs(currentHsv.s - targetHsv.s);
    const valDiff = Math.abs(currentHsv.v - targetHsv.v);
    
    const hsvDiff = (hueDiff / 180) * 100 + satDiff + valDiff;
    return hsvDiff <= tolerance * 0.8;
}

function chromaKeyMatch(r, g, b, targetR, targetG, targetB, tolerance) {
    // Chroma key especializado para verdes/azules
    const isGreenish = targetG > targetR && targetG > targetB;
    const isBlueish = targetB > targetR && targetB > targetG;
    
    if (isGreenish || isBlueish) {
        const chromaDiff = Math.abs(g - targetG) + Math.abs(b - targetB);
        const lumaDiff = Math.abs((r + g + b) - (targetR + targetG + targetB));
        return (chromaDiff + lumaDiff * 0.5) <= tolerance * 2;
    } else {
        return euclideanColorMatch(r, g, b, targetR, targetG, targetB, tolerance);
    }
}

// Auto-detectar color de fondo dominante
function autoDetectBackground() {
    if (!originalImageData) return;
    
    const data = originalImageData.data;
    const width = bgCanvas.width;
    const height = bgCanvas.height;
    const colorCounts = {};
    
    // Muestrear bordes para encontrar color dominante
    const samplePoints = [];
    
    // Bordes superior e inferior
    for (let x = 0; x < width; x += 10) {
        samplePoints.push([x, 0], [x, height - 1]);
    }
    // Bordes izquierdo y derecho
    for (let y = 0; y < height; y += 10) {
        samplePoints.push([0, y], [width - 1, y]);
    }
    
    samplePoints.forEach(([x, y]) => {
        const index = (y * width + x) * 4;
        const r = data[index];
        const g = data[index + 1];
        const b = data[index + 2];
        
        // Agrupar colores similares (reducir precisi√≥n)
        const key = `${Math.floor(r/10)*10},${Math.floor(g/10)*10},${Math.floor(b/10)*10}`;
        colorCounts[key] = (colorCounts[key] || 0) + 1;
    });
    
    // Encontrar color m√°s com√∫n
    let maxCount = 0;
    let dominantColor = '255,255,255';
    
    for (const [color, count] of Object.entries(colorCounts)) {
        if (count > maxCount) {
            maxCount = count;
            dominantColor = color;
        }
    }
    
    const [r, g, b] = dominantColor.split(',').map(Number);
    const hex = `#${((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1)}`;
    
    document.getElementById('bg-color-picker').value = hex;
    document.getElementById('tolerance-slider').value = 50;
    document.getElementById('tolerance-value').textContent = '50';
    
    showNotification(`ü§ñ Color de fondo detectado: ${hex}`);
    removeBackgroundAdvanced();
}

// Herramienta varita m√°gica (selecci√≥n por regi√≥n)
function magicWandTool() {
    showNotification('‚ú® Haz clic en el √°rea que deseas remover');
    
    bgCanvas.style.cursor = 'crosshair';
    
    const magicWandHandler = function(e) {
        const rect = bgCanvas.getBoundingClientRect();
        const x = Math.floor(e.clientX - rect.left);
        const y = Math.floor(e.clientY - rect.top);
        
        floodFillRemoval(x, y);
        
        bgCanvas.removeEventListener('click', magicWandHandler);
        bgCanvas.style.cursor = 'crosshair';
        showNotification('‚úÖ Regi√≥n removida con varita m√°gica');
    };
    
    bgCanvas.addEventListener('click', magicWandHandler);
}

// Algoritmo flood fill para varita m√°gica
function floodFillRemoval(startX, startY) {
    const imageData = bgCtx.getImageData(0, 0, bgCanvas.width, bgCanvas.height);
    const data = imageData.data;
    const width = bgCanvas.width;
    const height = bgCanvas.height;
    
    const startIndex = (startY * width + startX) * 4;
    const targetR = data[startIndex];
    const targetG = data[startIndex + 1];
    const targetB = data[startIndex + 2];
    
    const tolerance = parseInt(document.getElementById('tolerance-slider').value);
    const visited = new Set();
    const stack = [[startX, startY]];
    
    while (stack.length > 0) {
        const [x, y] = stack.pop();
        
        if (x < 0 || x >= width || y < 0 || y >= height) continue;
        
        const key = `${x},${y}`;
        if (visited.has(key)) continue;
        visited.add(key);
        
        const index = (y * width + x) * 4;
        const r = data[index];
        const g = data[index + 1];
        const b = data[index + 2];
        
        const diff = Math.sqrt(
            Math.pow(r - targetR, 2) + 
            Math.pow(g - targetG, 2) + 
            Math.pow(b - targetB, 2)
        );
        
        if (diff <= tolerance * 2) {
            data[index + 3] = 0; // Hacer transparente
            
            // A√±adir p√≠xeles vecinos
            stack.push([x + 1, y], [x - 1, y], [x, y + 1], [x, y - 1]);
        }
    }
    
    bgCtx.putImageData(imageData, 0, 0);
}

// Funciones de post-procesamiento
function applyEdgeSmoothing() {
    if (!bgCtx) return;
    
    const imageData = bgCtx.getImageData(0, 0, bgCanvas.width, bgCanvas.height);
    const data = imageData.data;
    const width = bgCanvas.width;
    const height = bgCanvas.height;
    
    // Anti-aliasing en los bordes
    for (let y = 1; y < height - 1; y++) {
        for (let x = 1; x < width - 1; x++) {
            const index = (y * width + x) * 4;
            
            if (data[index + 3] === 0) continue; // Skip transparent
            
            // Contar p√≠xeles transparentes vecinos
            let transparentNeighbors = 0;
            const neighbors = [
                [-1, -1], [-1, 0], [-1, 1],
                [0, -1],           [0, 1],
                [1, -1],  [1, 0],  [1, 1]
            ];
            
            neighbors.forEach(([dx, dy]) => {
                const nIndex = ((y + dy) * width + (x + dx)) * 4;
                if (data[nIndex + 3] === 0) transparentNeighbors++;
            });
            
            // Aplicar suavizado si hay transparencia vecina
            if (transparentNeighbors > 0 && transparentNeighbors < 8) {
                const alpha = Math.max(50, 255 - (transparentNeighbors * 30));
                data[index + 3] = alpha;
            }
        }
    }
    
    bgCtx.putImageData(imageData, 0, 0);
    showNotification('üîß Bordes suavizados');
}

function removeNoise() {
    if (!bgCtx) return;
    
    const imageData = bgCtx.getImageData(0, 0, bgCanvas.width, bgCanvas.height);
    const data = imageData.data;
    const width = bgCanvas.width;
    const height = bgCanvas.height;
    const newData = new Uint8ClampedArray(data);
    
    // Filtro mediana para remover ruido
    for (let y = 1; y < height - 1; y++) {
        for (let x = 1; x < width - 1; x++) {
            const index = (y * width + x) * 4;
            
            const alphaValues = [];
            for (let dy = -1; dy <= 1; dy++) {
                for (let dx = -1; dx <= 1; dx++) {
                    const nIndex = ((y + dy) * width + (x + dx)) * 4;
                    alphaValues.push(data[nIndex + 3]);
                }
            }
            
            alphaValues.sort((a, b) => a - b);
            const medianAlpha = alphaValues[4]; // Valor mediano
            
            newData[index + 3] = medianAlpha;
        }
    }
    
    bgCtx.putImageData(new ImageData(newData, width, height), 0, 0);
    showNotification('üßπ Ruido removido');
}

function expandSelection() {
    if (!bgCtx) return;
    
    const imageData = bgCtx.getImageData(0, 0, bgCanvas.width, bgCanvas.height);
    const data = imageData.data;
    const width = bgCanvas.width;
    const height = bgCanvas.height;
    const newData = new Uint8ClampedArray(data);
    
    // Expandir √°reas transparentes
    for (let y = 1; y < height - 1; y++) {
        for (let x = 1; x < width - 1; x++) {
            const index = (y * width + x) * 4;
            
            if (data[index + 3] > 0) continue; // Skip non-transparent
            
            // Si hay p√≠xeles opacos vecinos, hacerlos transparentes
            const neighbors = [
                [-1, 0], [1, 0], [0, -1], [0, 1]
            ];
            
            neighbors.forEach(([dx, dy]) => {
                const nIndex = ((y + dy) * width + (x + dx)) * 4;
                if (data[nIndex + 3] > 0) {
                    newData[nIndex + 3] = 0;
                }
            });
        }
    }
    
    bgCtx.putImageData(new ImageData(newData, width, height), 0, 0);
    showNotification('‚ûï Selecci√≥n expandida');
}

function contractSelection() {
    if (!bgCtx) return;
    
    const imageData = bgCtx.getImageData(0, 0, bgCanvas.width, bgCanvas.height);
    const data = imageData.data;
    const width = bgCanvas.width;
    const height = bgCanvas.height;
    const newData = new Uint8ClampedArray(data);
    
    // Contraer √°reas transparentes
    for (let y = 1; y < height - 1; y++) {
        for (let x = 1; x < width - 1; x++) {
            const index = (y * width + x) * 4;
            
            if (data[index + 3] === 0) continue; // Skip transparent
            
            // Si hay p√≠xeles transparentes vecinos, hacer este transparente
            const neighbors = [
                [-1, 0], [1, 0], [0, -1], [0, 1]
            ];
            
            let hasTransparentNeighbor = false;
            neighbors.forEach(([dx, dy]) => {
                const nIndex = ((y + dy) * width + (x + dx)) * 4;
                if (data[nIndex + 3] === 0) {
                    hasTransparentNeighbor = true;
                }
            });
            
            if (hasTransparentNeighbor) {
                newData[index + 3] = 0;
            }
        }
    }
    
    bgCtx.putImageData(new ImageData(newData, width, height), 0, 0);
    showNotification('‚ûñ Selecci√≥n contra√≠da');
}

function resetImage() {
    if (originalImageData && bgCtx) {
        bgCtx.putImageData(originalImageData, 0, 0);
        showNotification('‚Ü©Ô∏è Imagen restaurada');
    }
}

function downloadProcessedImage() {
    if (bgCanvas) {
        const link = document.createElement('a');
        link.download = 'imagen-sin-fondo.png';
        link.href = bgCanvas.toDataURL('image/png');
        link.click();
        showNotification('üíæ Imagen descargada');
    }
}

// Funciones auxiliares para conversi√≥n de espacios de color
function rgbToLab(r, g, b) {
    // Simplified RGB to LAB conversion
    const x = r * 0.4124564 + g * 0.3575761 + b * 0.1804375;
    const y = r * 0.2126729 + g * 0.7151522 + b * 0.0721750;
    const z = r * 0.0193339 + g * 0.1191920 + b * 0.9503041;
    
    const fx = x > 0.008856 ? Math.pow(x / 95.047, 1/3) : (7.787 * x / 95.047 + 16/116);
    const fy = y > 0.008856 ? Math.pow(y / 100.000, 1/3) : (7.787 * y / 100.000 + 16/116);
    const fz = z > 0.008856 ? Math.pow(z / 108.883, 1/3) : (7.787 * z / 108.883 + 16/116);
    
    return {
        l: 116 * fy - 16,
        a: 500 * (fx - fy),
        b: 200 * (fy - fz)
    };
}

function rgbToHsv(r, g, b) {
    r /= 255;
    g /= 255;
    b /= 255;
    
    const max = Math.max(r, g, b);
    const min = Math.min(r, g, b);
    const diff = max - min;
    
    let h = 0;
    let s = max === 0 ? 0 : diff / max;
    let v = max;
    
    if (diff !== 0) {
        switch (max) {
            case r: h = (g - b) / diff + (g < b ? 6 : 0); break;
            case g: h = (b - r) / diff + 2; break;
            case b: h = (r - g) / diff + 4; break;
        }
        h /= 6;
    }
    
    return {
        h: h * 360,
        s: s * 100,
        v: v * 100
    };
}

        // ============ PROCESADOR DE VIDEOS ============
        function processVideoUrl() {
            const url = document.getElementById('video-url').value;
            const format = document.getElementById('video-format').value;
            const resultDiv = document.getElementById('video-result');

            if (!url.trim()) {
                showError(resultDiv, 'Por favor ingresa una URL v√°lida');
                return;
            }

            const videoId = extractVideoId(url);
            if (!videoId) {
                showError(resultDiv, 'URL no v√°lida. Usa YouTube, Instagram, Facebook o TikTok');
                return;
            }

            showVideoInfo(resultDiv, url, videoId, format);
        }

        function extractVideoId(url) {
            const youtubeRegex = /(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([a-zA-Z0-9_-]{11})/;
            const youtubeMatch = url.match(youtubeRegex);
            if (youtubeMatch) return { platform: 'youtube', id: youtubeMatch[1] };
            
            if (url.includes('instagram.com')) {
                const instagramRegex = /instagram\.com\/(?:p|reel)\/([a-zA-Z0-9_-]+)/;
                const instagramMatch = url.match(instagramRegex);
                if (instagramMatch) return { platform: 'instagram', id: instagramMatch[1] };
            }
            
            if (url.includes('facebook.com')) {
                return { platform: 'facebook', id: 'fb_video' };
            }
            
            if (url.includes('tiktok.com')) {
                const tiktokRegex = /tiktok\.com\/.*\/video\/(\d+)/;
                const tiktokMatch = url.match(tiktokRegex);
                if (tiktokMatch) return { platform: 'tiktok', id: tiktokMatch[1] };
            }
            
            return null;
        }

        function showVideoInfo(container, url, videoInfo, format) {
            const { platform, id } = videoInfo;
            
            container.innerHTML = `
                <div class="video-info">
                    <h4>üìπ Video detectado</h4>
                    <p><strong>Plataforma:</strong> ${platform.charAt(0).toUpperCase() + platform.slice(1)}</p>
                    <p><strong>ID:</strong> ${id}</p>
                    <p><strong>Formato:</strong> ${format.toUpperCase()}</p>
                    <p><strong>URL:</strong> <span style="word-break: break-all;">${url}</span></p>
                </div>
                <div class="download-links">
                    ${generateDownloadLinks(platform, id, format)}
                </div>
                <div class="success-message">
                    <p><strong>üìã Instrucciones:</strong></p>
                    <p>1. Haz clic en los enlaces de descarga</p>
                    <p>2. Se abrir√° la herramienta correspondiente</p>
                    <p>3. Pega la URL original y descarga</p>
                    <p><em>Nota: Estas herramientas son servicios externos gratuitos</em></p>
                </div>
            `;
        }

        function generateDownloadLinks(platform, id, format) {
            let links = '';
            
            if (platform === 'youtube') {
                links += `
                    <a href="https://ytmp3.cc/" target="_blank" class="download-link">
                        üéµ Descargar con YTMP3 (MP3/MP4)
                    </a>
                    <a href="https://y2mate.com/" target="_blank" class="download-link">
                        üìπ Descargar con Y2Mate
                    </a>
                    <a href="https://savefrom.net/" target="_blank" class="download-link">
                        üíæ Descargar con SaveFrom
                    </a>
                `;
            } else if (platform === 'instagram') {
                links += `
                    <a href="https://snapinsta.app/" target="_blank" class="download-link">
                        üì∏ Descargar con SnapInsta
                    </a>
                    <a href="https://igdownloader.com/" target="_blank" class="download-link">
                        üì± Descargar con IGDownloader
                    </a>
                `;
            } else if (platform === 'facebook') {
                links += `
                    <a href="https://fbdown.net/" target="_blank" class="download-link">
                        üìò Descargar con FBDown
                    </a>
                    <a href="https://getfvid.com/" target="_blank" class="download-link">
                        üîΩ Descargar con GetFVid
                    </a>
                `;
            } else if (platform === 'tiktok') {
                links += `
                    <a href="https://snaptik.app/" target="_blank" class="download-link">
                        üéµ Descargar con SnapTik
                    </a>
                    <a href="https://tikmate.online/" target="_blank" class="download-link">
                        üì± Descargar con TikMate
                    </a>
                `;
            }
            
            return links;
        }

        // ============ ACORTADOR DE URLs ============
        function shortenUrl() {
            const url = document.getElementById('long-url').value;
            const resultDiv = document.getElementById('url-result');

            if (!url.trim()) {
                showError(resultDiv, 'Por favor ingresa una URL');
                return;
            }

            if (!isValidUrl(url)) {
                showError(resultDiv, 'Por favor ingresa una URL v√°lida');
                return;
            }

            const existing = Object.keys(shortenedUrls).find(key => shortenedUrls[key] === url);
            if (existing) {
                showUrlResult(resultDiv, existing, url);
                return;
            }

            showLoading(resultDiv);

            setTimeout(() => {
                const shortCode = generateShortCode();
                const shortUrl = `https://tbx.pro/${shortCode}`;
                
                shortenedUrls[shortUrl] = url;
                try {
                    localStorage.setItem('shortenedUrls', JSON.stringify(shortenedUrls));
                } catch (e) {
                    console.log('Error guardando en localStorage');
                }
                
                showUrlResult(resultDiv, shortUrl, url);
            }, 1000);
        }

        function generateShortCode() {
            const chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            for (let i = 0; i < 6; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        function showUrlResult(container, shortUrl, originalUrl) {
            container.innerHTML = `
                <div class="success-message">
                    <h4>‚úÖ ¬°URL acortada exitosamente!</h4>
                    <div class="url-result-box">
                        ${shortUrl}
                    </div>
                    <button onclick="copyToClipboard('${shortUrl}')" class="btn btn-secondary">üìã Copiar URL</button>
                    <button onclick="showUrlStats('${shortUrl}')" class="btn btn-secondary">üìä Ver Estad√≠sticas</button>
                </div>
            `;
        }

        function showUrlStats(shortUrl) {
            const originalUrl = shortenedUrls[shortUrl];
            alert(`üìä Estad√≠sticas de URL:

üîó URL Corta: ${shortUrl}
üåê URL Original: ${originalUrl}
üìÖ Creada: ${new Date().toLocaleDateString()}
üëÜ Clics: 0 (funci√≥n demo)
üéØ Conversi√≥n: 0%

üí° Esta es una demostraci√≥n local usando localStorage`);
        }

        // ============ CONVERTIDOR DE COLORES ============
        function convertColors() {
            const colorInput = document.getElementById('color-input');
            const resultDiv = document.getElementById('color-result');
            const hex = colorInput.value;

            // Convertir HEX a RGB
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);

            // Convertir RGB a HSL
            const rNorm = r / 255;
            const gNorm = g / 255;
            const bNorm = b / 255;

            const max = Math.max(rNorm, gNorm, bNorm);
            const min = Math.min(rNorm, gNorm, bNorm);
            const diff = max - min;

            let h = 0;
            let s = 0;
            let l = (max + min) / 2;

            if (diff !== 0) {
                s = l > 0.5 ? diff / (2 - max - min) : diff / (max + min);
                
                switch (max) {
                    case rNorm:
                        h = (gNorm - bNorm) / diff + (gNorm < bNorm ? 6 : 0);
                        break;
                    case gNorm:
                        h = (bNorm - rNorm) / diff + 2;
                        break;
                    case bNorm:
                        h = (rNorm - gNorm) / diff + 4;
                        break;
                }
                h /= 6;
            }

            h = Math.round(h * 360);
            s = Math.round(s * 100);
            l = Math.round(l * 100);

            resultDiv.innerHTML = `
                <div class="success-message">
                    <h4>üåà Conversiones de Color</h4>
                    <div style="background: ${hex}; width: 100px; height: 50px; margin: 1rem auto; border-radius: 10px; border: 2px solid #333;"></div>
                    
                    <div style="text-align: left; margin: 1rem 0;">
                        <p><strong>HEX:</strong> <code>${hex.toUpperCase()}</code></p>
                        <p><strong>RGB:</strong> <code>rgb(${r}, ${g}, ${b})</code></p>
                        <p><strong>RGBA:</strong> <code>rgba(${r}, ${g}, ${b}, 1)</code></p>
                        <p><strong>HSL:</strong> <code>hsl(${h}, ${s}%, ${l}%)</code></p>
                        <p><strong>HSLA:</strong> <code>hsla(${h}, ${s}%, ${l}%, 1)</code></p>
                    </div>
                    
                    <button onclick="copyColorFormats('${hex}', '${r}, ${g}, ${b}', '${h}, ${s}%, ${l}%')" class="btn btn-secondary">
                        üìã Copiar Todos los Formatos
                    </button>
                </div>
            `;
        }

        function copyColorFormats(hex, rgb, hsl) {
            const formats = `HEX: ${hex.toUpperCase()}
RGB: rgb(${rgb})
RGBA: rgba(${rgb}, 1)
HSL: hsl(${hsl})
HSLA: hsla(${hsl}, 1)`;

            copyToClipboard(formats);
        }

        // ============ GENERADOR DE CONTRASE√ëAS ============
        function generatePassword() {
            const length = parseInt(document.getElementById('password-length').value);
            const includeUppercase = document.getElementById('include-uppercase').checked;
            const includeLowercase = document.getElementById('include-lowercase').checked;
            const includeNumbers = document.getElementById('include-numbers').checked;
            const includeSymbols = document.getElementById('include-symbols').checked;
            const resultDiv = document.getElementById('password-result');

            let charset = '';
            if (includeUppercase) charset += 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            if (includeLowercase) charset += 'abcdefghijklmnopqrstuvwxyz';
            if (includeNumbers) charset += '0123456789';
            if (includeSymbols) charset += '!@#$%^&*()_+-=[]{}|;:,.<>?';

            if (charset === '') {
                showError(resultDiv, 'Selecciona al menos un tipo de car√°cter');
                return;
            }

            let password = '';
            for (let i = 0; i < length; i++) {
                password += charset.charAt(Math.floor(Math.random() * charset.length));
            }

            // Calcular fortaleza
            let strength = 'D√©bil';
            let strengthColor = '#e74c3c';
            let score = 0;

            if (length >= 8) score++;
            if (length >= 12) score++;
            if (includeUppercase) score++;
            if (includeLowercase) score++;
            if (includeNumbers) score++;
            if (includeSymbols) score++;

            if (score >= 5) {
                strength = 'Muy Fuerte';
                strengthColor = '#27ae60';
            } else if (score >= 4) {
                strength = 'Fuerte';
                strengthColor = '#f39c12';
            } else if (score >= 3) {
                strength = 'Media';
                strengthColor = '#e67e22';
            }

            resultDiv.innerHTML = `
                <div class="success-message">
                    <h4>üîê Contrase√±a Generada</h4>
                    <div class="url-result-box" style="font-size: 1.2rem; letter-spacing: 1px;">
                        ${password}
                    </div>
                    <p><strong>Fortaleza:</strong> <span style="color: ${strengthColor}; font-weight: bold;">${strength}</span></p>
                    <p><strong>Longitud:</strong> ${length} caracteres</p>
                    <button onclick="copyToClipboard('${password}')" class="btn btn-secondary">üìã Copiar Contrase√±a</button>
                    <button onclick="generatePassword()" class="btn btn-secondary">üîÑ Generar Nueva</button>
                </div>
            `;
        }

        // ============ FUNCIONES AUXILIARES ============
        function showLoading(container) {
            container.innerHTML = '<div class="loading"></div>';
        }

        function showError(container, message) {
            container.innerHTML = `<div class="error-message">${message}</div>`;
        }

        function isValidUrl(string) {
            try {
                new URL(string);
                return true;
            } catch (_) {
                return false;
            }
        }

        function copyToClipboard(text) {
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text).then(() => {
                    showNotification('üìã ¬°Copiado al portapapeles!');
                });
            } else {
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showNotification('üìã ¬°Copiado al portapapeles!');
            }
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(45deg, #00b894, #55a3ff);
                color: white;
                padding: 1rem 1.5rem;
                border-radius: 10px;
                box-shadow: 0 5px 15px rgba(0,0,0,0.3);
                z-index: 1000;
                font-weight: 600;
                animation: slideIn 0.3s ease;
            `;
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // ============ EVENT LISTENERS ============
        document.addEventListener('DOMContentLoaded', function() {
            // Actualizar display de longitud de contrase√±a
            const lengthSlider = document.getElementById('password-length');
            const lengthDisplay = document.getElementById('length-display');
            
            lengthSlider.addEventListener('input', function() {
                lengthDisplay.textContent = this.value;
            });

            // Actualizar nombres de archivos seleccionados
            document.getElementById('qr-logo').addEventListener('change', function(e) {
                const display = this.parentNode.querySelector('.file-input-display');
                display.innerHTML = e.target.files[0] ? `üìÅ ${e.target.files[0].name}` : 'üìÅ Seleccionar imagen';
            });

            document.getElementById('bg-image').addEventListener('change', function(e) {
                const display = this.parentNode.querySelector('.file-input-display');
                display.innerHTML = e.target.files[0] ? `üìÅ ${e.target.files[0].name}` : 'üìÅ Seleccionar imagen';
            });

            // Mostrar informaci√≥n de URLs guardadas
            const savedCount = Object.keys(shortenedUrls).length;
            if (savedCount > 0) {
                console.log(`üìä URLs guardadas localmente: ${savedCount}`);
            }
        });

        // ============ ATAJOS DE TECLADO ============
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + Enter para generar QR
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                const activeElement = document.activeElement;
                if (activeElement.id === 'qr-text') {
                    generateQR();
                } else if (activeElement.id === 'long-url') {
                    shortenUrl();
                } else if (activeElement.id === 'video-url') {
                    processVideoUrl();
                }
            }
        });
    </script>
</body>
</html>